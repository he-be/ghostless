# 要件定義書 (Requirements Definition)

## プロジェクト名: Ghostless

### 1. プロジェクト概要
本プロジェクトは、VTuber（3tene）を用いた解説動画制作における「人為的な温かみ」と「機械的な効率性」を完全に分離し、JSONを中心とした「絶対王政」的なワークフローを構築することを目的とする。LLMの弱点（時間感覚の欠如）を補いつつ、演出の自動化と高品質化を同時に実現する。

### 2. 批判的分析と基本方針 (Critical Analysis)

#### 2.1 現状の課題と解決策
*   **課題**: LLMに「時間配分」や「具体的な秒数」を指示しても、精度が低く、映像と音声の同期ズレが発生する。
*   **解決策**: **「実時間駆動（Actual Time Driven）」**。生成されたWAVファイルの物理的な長さを正解（マスター）とし、映像の尺をそれに従属させることで、同期ズレを物理的に排除する。

*   **課題**: 3teneの膨大なモーションをLLMに直接指定させると、ハルシネーションや不自然な動作選択（文脈不一致）を招く。
*   **解決策**: **「インテント駆動（Intent Driven）」**。LLMは「挨拶」「同意」といった抽象的な演出意図のみを選択し、具体的なモーションの決定（ランダム選択、ゆらぎ）はPython側のロジックで処理する。

*   **課題**: 音声認識やリップシンクだけでは「死体が喋っている」ような不気味さが残る。
*   **解決策**: **「生命感の注入（Life Injection）」**。音声再生前の「予備動作（吸気）」、待機中の「マイクロムーブメント（瞬き、視線移動）」を自動挿入し、実在感を高める。

### 3. ユーザーストーリー (User Stories)

#### Phase 1: 企画・構成 (Planning)
*   **US-01**: 私は**ディレクター**として、**JSON形式の字コンテ**を作成したい。これにより、後の全工程を自動化するための揺るぎない設計図を確立できる。
*   **US-02**: 私は**リサーチャー**として、Gemini Deep Research等のレポートを元に、LLMにJSON構造の台本を生成させたい。これにより、構成作成の手間を大幅に削減できる。

#### Phase 2: 素材準備 (Asset Preparation)
*   **US-03**: 私は**クリエイター**として、JSONの指定に従って**スライド画像**（PNG）を用意したい。これにより、AIが苦手な「センスの良い画像選定」を人間が担保できる。
*   **US-04**: 私は**声優（または調整者）**として、読み上げスクリプトから高品質な**音声ファイル**（WAV）を作成・選別したい。これにより、感情表現豊かな「正解の音声」を確定できる。

#### Phase 3: 自動撮影・統合 (Automation)
*   **US-05**: 私は**システム（Python）**に対し、音声ファイルの長さを自動計測させたい。これにより、スライド表示時間やキャラ演技時間を1ミリ秒単位で正確に同期できる。
*   **US-06**: 私は**演出システム**として、抽象的な「モーションタグ（例: agree）」を、ランダムな「具体的モーション（MIDIノート）」に変換したい。これにより、繰り返しの機械的な動きを排除し、自然な演技を実現できる。
*   **US-07**: 私は**撮影システム**として、発話の直前に「息を吸う」ような予備動作を自動挿入したい。これにより、発話の自然さと実在感を向上できる。
*   **US-08**: 私は**編集システム**として、背景画像、グリーンバックのVTuber映像、高音質音声を自動で合成（コンポジット）したい。これにより、動画編集ソフトでの手作業を全廃できる。

### 4. 機能要件 (Functional Requirements)

#### 4.1 JSONデータ構造
字コンテとなるJSONは以下の構造を持つこと。
```json
{
  "project_title": "ProjectName",
  "scenes": [
    {
      "id": "001",
      "text": "セリフ内容",
      "motion_tag": "greeting", 
      "intensity": "normal",
      "image_file": "slide_001.png",
      "voice_file": "voice_001.wav"
    }
  ]
}
```

#### 4.2 Python制御モジュール (`Director`)
*   **Motion DB**: `motion_tag` と MIDIノート番号のマッピング定義。1つのタグに対し複数の候補を持ち、ランダム選択可能にする。
*   **Latency Control**: 音声再生に対し、モーション（MIDI送信）を先行させる（負のレイテンシ、pre-motion）制御機能。
*   **Composite**: `moviepy` を使用し、画像・動画・音声をレイヤー合成して書き出す機能。

#### 4.3 外部連携インタフェース
*   **3tene**: IAC Driver (MacOS) を経由したMIDI信号による表情・モーション制御。
*   **Audio**: Virtual Audio Cable (BlackHole等) を経由したリップシンク用音声入力。

### 5. 非機能要件 (Non-Functional Requirements)
*   **OS**: macOS (User Environment)
*   **Latency**: 音声とリップシンクのズレを違和感のない範囲に抑えること。
*   **Quality**: 最終出力は1920x1080 (FullHD) 以上の解像度を維持すること。
